;
(function() {
    const calcWidth = item => {
        let reqItemWidth = 0;
        const screenWidth = $(window).width();
        const container = item.closest(".horizontal-accordion__list");
        const titleBloks = container.find(".horizontal-accordion__link");
        const titleWidth = titleBloks.width() * titleBloks.length;
        const textBlockWidth = screenWidth - titleBloks.width();
        const textBlock = item.find(".horizontal-accordion__text-content");
        const paddingLeft = parseInt(textBlock.css("padding-left"));
        const paddingRight = parseInt(textBlock.css("padding-right"));
        const isTablet = window.matchMedia("(max-width: 768px)").matches;
        const isPhone = window.matchMedia("(max-width: 480px)").matches;
        if (isPhone) {
            reqItemWidth = textBlockWidth;
        } else if (isTablet) {
            reqItemWidth = screenWidth - titleWidth
        } else {
            reqItemWidth = 524;
        }
        return {
            container: reqItemWidth,
            textContainer: reqItemWidth - paddingLeft - paddingRight
        }

    }
    const closeEveryItem = container => {
        const items = container.find(".horizontal-accordion__text");
        const itemContainer = container.find(".horizontal-accordion__item");
        itemContainer.removeClass("active");
        itemContainer.removeClass("horizontal-accordion__item--phone");
        items.width(0);
    }

    const openItem = (item) => {
        const itemContainer = item.closest(".horizontal-accordion__item");
        const contentBlock = item.find(".horizontal-accordion__text");
        const textBlock = item.find(".horizontal-accordion__text-content");
        const reqWidth = calcWidth(item);
        const isPhone = window.matchMedia("(max-width: 480px)").matches;
        itemContainer.addClass("active");
        contentBlock.width(reqWidth.container);
        textBlock.width(reqWidth.textContainer);
        if (isPhone) {
            itemContainer.addClass("horizontal-accordion__item--phone");
        }


    }
    $(".horizontal-accordion__link").on("click", e => {
        e.preventDefault();
        const $this = $(e.currentTarget);
        const item = $this.closest(".horizontal-accordion__item");
        const container = item.closest(".horizontal-accordion__list");
        if (item.hasClass("active")) {
            closeEveryItem(container);
        } else {
            closeEveryItem(container);
            openItem(item);
        }
    });
})();;
(function() {
    let myMap;
    const init = () => {
        myMap = new ymaps.Map("map", {
            center: [56.828371, 60.624425],
            zoom: 12,
            controls: []
        });
        const coords = [
            [56.828371, 60.624425],
            [56.844763, 60.590410],
            [56.825718, 60.606615],
            [56.801371, 60.563919],
            [56.893155, 60.572331]
        ];
        const myCollection = new ymaps.GeoObjectCollection({}, {
            draggable: false,
            iconLayout: 'default#image',
            iconImageHref: './images/marker.svg',
            iconImageSize: [46, 57],
            iconImageOffset: [-35, -52]
        });
        coords.forEach(coord => {
            myCollection.add(new ymaps.Placemark(coord));
        });
        myMap.geoObjects.add(myCollection);
        myMap.behaviors.disable('scrollZoom');
    }
    ymaps.ready(init);
})()
let myMap;
const init = () => {
    myMap = new ymaps.Map("map", {
        center: [56.828371, 60.624425],
        zoom: 12,
        controls: []
    });
    const coords = [
        [56.828371, 60.624425],
        [56.844763, 60.590410],
        [56.825718, 60.606615],
        [56.801371, 60.563919],
        [56.893155, 60.572331]
    ];
    const myCollection = new ymaps.GeoObjectCollection({}, {
        draggable: false,
        iconLayout: 'default#image',
        iconImageHref: './images/marker.svg',
        iconImageSize: [46, 57],
        iconImageOffset: [-35, -52]
    });
    coords.forEach(coord => {
        myCollection.add(new ymaps.Placemark(coord));
    });
    myMap.geoObjects.add(myCollection);
    myMap.behaviors.disable('scrollZoom');
}
ymaps.ready(init);;;
(function() {
    const closeNav = document.querySelector(".cross");
    const openNav = document.querySelector(".burger");
    const nav = document.querySelector("active");

    openNav.addEventListener('click', e => {
        e.preventDefault();
        document.getElementsByClassName('active')[0].style.display = "flex";
        document.getElementsByTagName('body')[0].style.overflow = "hidden";
    });

    closeNav.addEventListener('click', e => {
        e.preventDefault();
        document.getElementsByClassName('active')[0].style.display = "none";
        document.getElementsByTagName('body')[0].style.overflow = "scroll";
    });
})();;
(function() {
    const validateFields = (form, fieldsArray) => {
        fieldsArray.forEach(field => {
            field.removeClass("input-error");
            if (field.val().trim() == "") {
                field.addClass("input-error");
            }
        });

        const errorFields = form.find('.input-error');
        return errorFields.length == 0;
    }

    $('.form').submit(e => {
        e.preventDefault();
        const form = $(e.currentTarget);
        const name = form.find("[name='name']");
        const phone = form.find("[name='phone']");
        const comment = form.find("[name='comment']");
        const to = form.find("[name='to']");

        const modal = $('#modal');
        const content = modal.find('.modal__message')

        const isValid = validateFields(form, [name, phone, comment, to]);

        if (isValid) {
            const request = $.ajax({
                url: 'https://webdev-api.loftschool.com/sendmail',
                method: 'post',
                data: {
                    name: name.val(),
                    phone: phone.val(),
                    comment: comment.val(),
                    to: to.val(),
                },
            });
            request.done(data => {
                content.text(data.message);
                content.removeClass('error-modal');
            });
            request.fail(data => {
                console.log(data.responseJSON.message);
                const message = data.responseJSON.message;
                content.text(message);
                content.addClass('error-modal');
            });
            request.always(() => {
                $.fancybox.open({
                    src: "#modal",
                    type: "inline",

                });
            })
        }
    });

    $(".app-close-modal").click(e => {
        e.preventDefault();
        $.fancybox.close();

    });
})();;
(function() {
    const sections = $("section");
    const display = $(".maincontent");
    const fixMenu = $(".fixed-menu");
    const menuItems = fixMenu.find(".fixed-menu__item");
    const mobileDetect = new MobileDetect(window.navigator.userAgent);
    const isMobile = mobileDetect.mobile();
    let inScroll = false;

    sections.first().addClass("active-section");
    const countSectionPosition = sectionEq => {
        const position = sectionEq * -100;
        if (isNaN(position)) {
            console.error("Передано не верное значение в countSectionPosition");
            return 0;
        }
        return position;

    };
    const changeMenuThemeForSection = sectionEq => {
        const currentSection = sections.eq(sectionEq);
        const menuTheme = currentSection.attr("data-fix-menu-color");
        const activeClass = "fixed-menu--white";

        if (menuTheme == "light") {
            fixMenu.addClass(activeClass);
        } else {
            fixMenu.removeClass(activeClass);
        }

    };
    const resetActiveClassForItem = (items, itemEq, activeClass) => {
        items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
    }

    const performTransiton = (sectionEq) => {
        if (inScroll) return;
        const transitionOver = 1000;
        const mouseInertiaOver = 300;
        inScroll = true;
        const position = countSectionPosition(sectionEq);
        changeMenuThemeForSection(sectionEq);

        display.css({
            transform: `translateY(${position}%)`
        });
        resetActiveClassForItem(sections, sectionEq, "active-section");

        setTimeout(() => {
            inScroll = false;
            resetActiveClassForItem(menuItems, sectionEq, "fixed-menu__item--active");

        }, transitionOver + mouseInertiaOver);
    };



    const vieportScroller = () => {
        const activeSection = sections.filter(".active-section");
        const nextSection = activeSection.next();
        const prevSection = activeSection.prev();

        return {
            next() {
                if (nextSection.length) {
                    performTransiton(nextSection.index());
                }
            },
            prev() {
                if (prevSection.length) {
                    performTransiton(prevSection.index());
                }
            }
        }
    }

    $(window).on("wheel", e => {
        const deltaY = e.originalEvent.deltaY;
        const scroller = vieportScroller();
        if (deltaY > 0) {
            scroller.next();
        }
        if (deltaY < 0) {
            scroller.prev();
        }
    });
    $(window).on("keydown", e => {
        const tagName = e.target.tagName.toLowerCase();
        const userTypingInInputs = tagName == tagName == "input" || tagName == "textarea";
        const scroller = vieportScroller();
        if (userTypingInInputs) return;
        switch (e.keyCode) {
            case 38:
                scroller.prev;
                break;
            case 40:
                scroller.next;
                break;
        }
    });
    $("wrapper").on("touchmove", e => e.preventDefault());

    $("[data-scroll-to]").click(e => {
        e.preventDefault();
        const nav = $(".active")
        const $this = $(e.currentTarget);
        const target = $this.attr("data-scroll-to");
        const reqSection = $(`[data-section-id=${target}]`);
        nav.css({ display: "none" });
        performTransiton(reqSection.index());
    });
    if (isMobile) {
        $("body").swipe({

            swipe: function(event, direction) {
                const scroller = vieportScroller();
                let scrollDirection = "";
                if (direction == "up") scrollDirection = "next";
                if (direction == "down") scrollDirection = "prev";

                scroller[scrollDirection]();
            },
        });
    }
})();;
(function() {
    const player = $(".player__content");
    const durationControl = document.querySelector(".player__playback-duration");
    const controlProgress = document.querySelector(".player__playback-progress")
    const soundProgress = document.querySelector(".player__sound-progress");
    const soundControl = document.querySelector(".player__sound-volume-level");
    const MAX_SOUND_VALUE = 10;
    const updateRange = 1000;
    const playButtonOnScreen = document.querySelector(".player__on-screen-start");
    const playerButton = document.querySelector(".player__start");
    const playerContainer = document.querySelector(".player__container");
    const playerWrapper = document.querySelector(".player__wrapper");
    const soundButton = document.querySelector(".player__sound-img");
    let intervalId;
    let soundLevel;

    document.addEventListener("DOMContentLoaded", function() {
        player[0].addEventListener("canplaythrough", () => {
            durationControl.max = player[0].duration;
        });
        durationControl.min = 0;
        durationControl.value = 0;
        durationControl.max = player[0].duration;
        soundControl.min = 0;
        soundControl.max = MAX_SOUND_VALUE;
        volumeProgress();
        initPlayButton();
        addListener();
    });

    function initPlayButton() {
        const playButtons = document.querySelectorAll(".play-button");
        playButtons.forEach(button => {
            button.addEventListener("click", playStop)
            progressPlayback();
        });
    };

    function addListener() {
        playerWrapper.addEventListener("click", playStop);
        durationControl.addEventListener("click", setVideoDuration);
        durationControl.addEventListener("mousedown", stopInterval);
        soundControl.addEventListener("click", changeSoundVolume);

        soundButton.addEventListener("click", e => {
            e.preventDefault();
            if (player[0].volume == 0) {
                player[0].volume = soundLevel;
                soundControl.value = soundLevel * MAX_SOUND_VALUE;
                soundButton.classList.remove("player__sound-img--mute");
                volumeProgress();

            } else {
                soundLevel = player[0].volume;
                player[0].volume = 0;
                soundControl.value = 0;
                soundButton.classList.add("player__sound-img--mute");
                volumeProgress();
            }
        });
    }

    function playStop() {
        if (player[0].paused) {
            intervalId = setInterval(updateDuration, updateRange);
            player[0].play();
            playButtonOnScreen.classList.add("player__on-screen-start--hidden");
            playerContainer.classList.add("player__container--paused");


        } else {
            stopInterval();
            playButtonOnScreen.classList.remove("player__on-screen-start--hidden");
            playerContainer.classList.remove("player__container--paused");
        }
    }

    function updateDuration() {
        durationControl.value = player[0].currentTime;
        progressPlayback();
    }

    function setVideoDuration() {
        intervalId = setInterval(updateDuration, updateRange);
        player[0].currentTime = durationControl.value;
        progressPlayback();
        if (player[0].paused) {
            player[0].play();
            playButtonOnScreen.classList.add("player__on-screen-start--hidden");
            console.log(player[0].volume);
        }

    }

    function stopInterval() {
        player[0].pause();
        clearInterval(intervalId);
    };

    function changeSoundVolume() {
        player[0].volume = soundControl.value / MAX_SOUND_VALUE;
        volumeProgress();
    }

    function progressPlayback() {
        const completePlaybackPersent = (player[0].currentTime / player[0].duration) * 100;
        controlProgress.style.width = completePlaybackPersent + "%";
    }

    function volumeProgress() {
        completeVolumePersent = (player[0].volume / MAX_SOUND_VALUE) * 1000;
        soundProgress.style.width = completeVolumePersent + "%";
    }
})();;
(function() {
    const slider = $('.slider__list').bxSlider({
        pager: false,
        controls: false,
        //touchEnabled: false
    });

    $('.slider__button--left').click(e => {
        e.preventDefault();
        slider.goToPrevSlide();
    })
    $('.slider__button--right').click(e => {
        e.preventDefault();
        slider.goToNextSlide();
    });

})();;
(function() {
    const findBlock = (alias) => {
        return $('.reviews__item').filter((ndx, item) => {
            return $(item).attr('data-linked-with') == alias;
        });
    };
    $('.interactive-avatar__link').click((e) => {
        e.preventDefault();
        const $this = $(e.currentTarget);
        const target = $this.attr('data-open');
        const showItem = findBlock(target);
        const currrentItem = $this.closest('.reviews__selector-item')
        showItem.addClass('reviews__item--active').siblings().removeClass('reviews__item--active')
        currrentItem.addClass('interactive-avatar--active').siblings().removeClass('interactive-avatar--active');
    })
})();;
(function() {
    $(document).ready(function() {
        let name = $('.member__name');
        name.on('click', function(e) {
            e.preventDefault();
            let dropDown = $('.member__dropdown');
            dropDown.slideUp(200);
            name.removeClass('member__name--open');
            name.addClass('member__name--closed');
            if (!$(this).next().is(":visible")) {
                $(this).next().slideDown(200);
                $(this).addClass('member__name--open');
                $(this).removeClass('member__name--closed');
            };
        });

    });
})()
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvcml6b250YWxBY2Nvcmlvbi5qcyIsIm1hcC5qcyIsIm1lbnUuanMiLCJtb2RhbC5qcyIsIm9wcy5qcyIsInBsYXllci5qcyIsInNsaWRlci5qcyIsInNsaWRlU2hvdy5qcyIsInZlcnRpY2FsQWNjb3JkaW9uLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQzlEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0NqQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0MvREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtDN0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtDbEhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQ2pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1haW4ubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiO1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICBjb25zdCBjYWxjV2lkdGggPSBpdGVtID0+IHtcclxuICAgICAgICBsZXQgcmVxSXRlbVdpZHRoID0gMDtcclxuICAgICAgICBjb25zdCBzY3JlZW5XaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xyXG4gICAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGl0ZW0uY2xvc2VzdChcIi5ob3Jpem9udGFsLWFjY29yZGlvbl9fbGlzdFwiKTtcclxuICAgICAgICBjb25zdCB0aXRsZUJsb2tzID0gY29udGFpbmVyLmZpbmQoXCIuaG9yaXpvbnRhbC1hY2NvcmRpb25fX2xpbmtcIik7XHJcbiAgICAgICAgY29uc3QgdGl0bGVXaWR0aCA9IHRpdGxlQmxva3Mud2lkdGgoKSAqIHRpdGxlQmxva3MubGVuZ3RoO1xyXG4gICAgICAgIGNvbnN0IHRleHRCbG9ja1dpZHRoID0gc2NyZWVuV2lkdGggLSB0aXRsZUJsb2tzLndpZHRoKCk7XHJcbiAgICAgICAgY29uc3QgdGV4dEJsb2NrID0gaXRlbS5maW5kKFwiLmhvcml6b250YWwtYWNjb3JkaW9uX190ZXh0LWNvbnRlbnRcIik7XHJcbiAgICAgICAgY29uc3QgcGFkZGluZ0xlZnQgPSBwYXJzZUludCh0ZXh0QmxvY2suY3NzKFwicGFkZGluZy1sZWZ0XCIpKTtcclxuICAgICAgICBjb25zdCBwYWRkaW5nUmlnaHQgPSBwYXJzZUludCh0ZXh0QmxvY2suY3NzKFwicGFkZGluZy1yaWdodFwiKSk7XHJcbiAgICAgICAgY29uc3QgaXNUYWJsZXQgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDc2OHB4KVwiKS5tYXRjaGVzO1xyXG4gICAgICAgIGNvbnN0IGlzUGhvbmUgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDQ4MHB4KVwiKS5tYXRjaGVzO1xyXG4gICAgICAgIGlmIChpc1Bob25lKSB7XHJcbiAgICAgICAgICAgIHJlcUl0ZW1XaWR0aCA9IHRleHRCbG9ja1dpZHRoO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoaXNUYWJsZXQpIHtcclxuICAgICAgICAgICAgcmVxSXRlbVdpZHRoID0gc2NyZWVuV2lkdGggLSB0aXRsZVdpZHRoXHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgcmVxSXRlbVdpZHRoID0gNTI0O1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICBjb250YWluZXI6IHJlcUl0ZW1XaWR0aCxcclxuICAgICAgICAgICAgdGV4dENvbnRhaW5lcjogcmVxSXRlbVdpZHRoIC0gcGFkZGluZ0xlZnQgLSBwYWRkaW5nUmlnaHRcclxuICAgICAgICB9XHJcblxyXG4gICAgfVxyXG4gICAgY29uc3QgY2xvc2VFdmVyeUl0ZW0gPSBjb250YWluZXIgPT4ge1xyXG4gICAgICAgIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoXCIuaG9yaXpvbnRhbC1hY2NvcmRpb25fX3RleHRcIik7XHJcbiAgICAgICAgY29uc3QgaXRlbUNvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKFwiLmhvcml6b250YWwtYWNjb3JkaW9uX19pdGVtXCIpO1xyXG4gICAgICAgIGl0ZW1Db250YWluZXIucmVtb3ZlQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICAgICAgaXRlbUNvbnRhaW5lci5yZW1vdmVDbGFzcyhcImhvcml6b250YWwtYWNjb3JkaW9uX19pdGVtLS1waG9uZVwiKTtcclxuICAgICAgICBpdGVtcy53aWR0aCgwKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBvcGVuSXRlbSA9IChpdGVtKSA9PiB7XHJcbiAgICAgICAgY29uc3QgaXRlbUNvbnRhaW5lciA9IGl0ZW0uY2xvc2VzdChcIi5ob3Jpem9udGFsLWFjY29yZGlvbl9faXRlbVwiKTtcclxuICAgICAgICBjb25zdCBjb250ZW50QmxvY2sgPSBpdGVtLmZpbmQoXCIuaG9yaXpvbnRhbC1hY2NvcmRpb25fX3RleHRcIik7XHJcbiAgICAgICAgY29uc3QgdGV4dEJsb2NrID0gaXRlbS5maW5kKFwiLmhvcml6b250YWwtYWNjb3JkaW9uX190ZXh0LWNvbnRlbnRcIik7XHJcbiAgICAgICAgY29uc3QgcmVxV2lkdGggPSBjYWxjV2lkdGgoaXRlbSk7XHJcbiAgICAgICAgY29uc3QgaXNQaG9uZSA9IHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1heC13aWR0aDogNDgwcHgpXCIpLm1hdGNoZXM7XHJcbiAgICAgICAgaXRlbUNvbnRhaW5lci5hZGRDbGFzcyhcImFjdGl2ZVwiKTtcclxuICAgICAgICBjb250ZW50QmxvY2sud2lkdGgocmVxV2lkdGguY29udGFpbmVyKTtcclxuICAgICAgICB0ZXh0QmxvY2sud2lkdGgocmVxV2lkdGgudGV4dENvbnRhaW5lcik7XHJcbiAgICAgICAgaWYgKGlzUGhvbmUpIHtcclxuICAgICAgICAgICAgaXRlbUNvbnRhaW5lci5hZGRDbGFzcyhcImhvcml6b250YWwtYWNjb3JkaW9uX19pdGVtLS1waG9uZVwiKTtcclxuICAgICAgICB9XHJcblxyXG5cclxuICAgIH1cclxuICAgICQoXCIuaG9yaXpvbnRhbC1hY2NvcmRpb25fX2xpbmtcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgaXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIuaG9yaXpvbnRhbC1hY2NvcmRpb25fX2l0ZW1cIik7XHJcbiAgICAgICAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLmhvcml6b250YWwtYWNjb3JkaW9uX19saXN0XCIpO1xyXG4gICAgICAgIGlmIChpdGVtLmhhc0NsYXNzKFwiYWN0aXZlXCIpKSB7XHJcbiAgICAgICAgICAgIGNsb3NlRXZlcnlJdGVtKGNvbnRhaW5lcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgY2xvc2VFdmVyeUl0ZW0oY29udGFpbmVyKTtcclxuICAgICAgICAgICAgb3Blbkl0ZW0oaXRlbSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbn0pKCkiLCI7XHJcbihmdW5jdGlvbigpIHtcclxuICAgIGxldCBteU1hcDtcclxuICAgIGNvbnN0IGluaXQgPSAoKSA9PiB7XHJcbiAgICAgICAgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKFwibWFwXCIsIHtcclxuICAgICAgICAgICAgY2VudGVyOiBbNTYuODI4MzcxLCA2MC42MjQ0MjVdLFxyXG4gICAgICAgICAgICB6b29tOiAxMixcclxuICAgICAgICAgICAgY29udHJvbHM6IFtdXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc3QgY29vcmRzID0gW1xyXG4gICAgICAgICAgICBbNTYuODI4MzcxLCA2MC42MjQ0MjVdLFxyXG4gICAgICAgICAgICBbNTYuODQ0NzYzLCA2MC41OTA0MTBdLFxyXG4gICAgICAgICAgICBbNTYuODI1NzE4LCA2MC42MDY2MTVdLFxyXG4gICAgICAgICAgICBbNTYuODAxMzcxLCA2MC41NjM5MTldLFxyXG4gICAgICAgICAgICBbNTYuODkzMTU1LCA2MC41NzIzMzFdXHJcbiAgICAgICAgXTtcclxuICAgICAgICBjb25zdCBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbih7fSwge1xyXG4gICAgICAgICAgICBkcmFnZ2FibGU6IGZhbHNlLFxyXG4gICAgICAgICAgICBpY29uTGF5b3V0OiAnZGVmYXVsdCNpbWFnZScsXHJcbiAgICAgICAgICAgIGljb25JbWFnZUhyZWY6ICcuL2ltYWdlcy9tYXJrZXIuc3ZnJyxcclxuICAgICAgICAgICAgaWNvbkltYWdlU2l6ZTogWzQ2LCA1N10sXHJcbiAgICAgICAgICAgIGljb25JbWFnZU9mZnNldDogWy0zNSwgLTUyXVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGNvb3Jkcy5mb3JFYWNoKGNvb3JkID0+IHtcclxuICAgICAgICAgICAgbXlDb2xsZWN0aW9uLmFkZChuZXcgeW1hcHMuUGxhY2VtYXJrKGNvb3JkKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlDb2xsZWN0aW9uKTtcclxuICAgICAgICBteU1hcC5iZWhhdmlvcnMuZGlzYWJsZSgnc2Nyb2xsWm9vbScpO1xyXG4gICAgfVxyXG4gICAgeW1hcHMucmVhZHkoaW5pdCk7XHJcbn0pKClcclxubGV0IG15TWFwO1xyXG5jb25zdCBpbml0ID0gKCkgPT4ge1xyXG4gICAgbXlNYXAgPSBuZXcgeW1hcHMuTWFwKFwibWFwXCIsIHtcclxuICAgICAgICBjZW50ZXI6IFs1Ni44MjgzNzEsIDYwLjYyNDQyNV0sXHJcbiAgICAgICAgem9vbTogMTIsXHJcbiAgICAgICAgY29udHJvbHM6IFtdXHJcbiAgICB9KTtcclxuICAgIGNvbnN0IGNvb3JkcyA9IFtcclxuICAgICAgICBbNTYuODI4MzcxLCA2MC42MjQ0MjVdLFxyXG4gICAgICAgIFs1Ni44NDQ3NjMsIDYwLjU5MDQxMF0sXHJcbiAgICAgICAgWzU2LjgyNTcxOCwgNjAuNjA2NjE1XSxcclxuICAgICAgICBbNTYuODAxMzcxLCA2MC41NjM5MTldLFxyXG4gICAgICAgIFs1Ni44OTMxNTUsIDYwLjU3MjMzMV1cclxuICAgIF07XHJcbiAgICBjb25zdCBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbih7fSwge1xyXG4gICAgICAgIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgICAgICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG4gICAgICAgIGljb25JbWFnZUhyZWY6ICcuL2ltYWdlcy9tYXJrZXIuc3ZnJyxcclxuICAgICAgICBpY29uSW1hZ2VTaXplOiBbNDYsIDU3XSxcclxuICAgICAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMzUsIC01Ml1cclxuICAgIH0pO1xyXG4gICAgY29vcmRzLmZvckVhY2goY29vcmQgPT4ge1xyXG4gICAgICAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhjb29yZCkpO1xyXG4gICAgfSk7XHJcbiAgICBteU1hcC5nZW9PYmplY3RzLmFkZChteUNvbGxlY3Rpb24pO1xyXG4gICAgbXlNYXAuYmVoYXZpb3JzLmRpc2FibGUoJ3Njcm9sbFpvb20nKTtcclxufVxyXG55bWFwcy5yZWFkeShpbml0KTsiLCI7XHJcbihmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IGNsb3NlTmF2ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5jcm9zc1wiKTtcclxuICAgIGNvbnN0IG9wZW5OYXYgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ1cmdlclwiKTtcclxuICAgIGNvbnN0IG5hdiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJhY3RpdmVcIik7XHJcblxyXG4gICAgb3Blbk5hdi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdhY3RpdmUnKVswXS5zdHlsZS5kaXNwbGF5ID0gXCJmbGV4XCI7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5zdHlsZS5vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XHJcbiAgICB9KTtcclxuXHJcbiAgICBjbG9zZU5hdi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xyXG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdhY3RpdmUnKVswXS5zdHlsZS5kaXNwbGF5ID0gXCJub25lXCI7XHJcbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2JvZHknKVswXS5zdHlsZS5vdmVyZmxvdyA9IFwic2Nyb2xsXCI7XHJcbiAgICB9KTtcclxufSkoKSIsIjtcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgY29uc3QgdmFsaWRhdGVGaWVsZHMgPSAoZm9ybSwgZmllbGRzQXJyYXkpID0+IHtcclxuICAgICAgICBmaWVsZHNBcnJheS5mb3JFYWNoKGZpZWxkID0+IHtcclxuICAgICAgICAgICAgZmllbGQucmVtb3ZlQ2xhc3MoXCJpbnB1dC1lcnJvclwiKTtcclxuICAgICAgICAgICAgaWYgKGZpZWxkLnZhbCgpLnRyaW0oKSA9PSBcIlwiKSB7XHJcbiAgICAgICAgICAgICAgICBmaWVsZC5hZGRDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGNvbnN0IGVycm9yRmllbGRzID0gZm9ybS5maW5kKCcuaW5wdXQtZXJyb3InKTtcclxuICAgICAgICByZXR1cm4gZXJyb3JGaWVsZHMubGVuZ3RoID09IDA7XHJcbiAgICB9XHJcblxyXG4gICAgJCgnLmZvcm0nKS5zdWJtaXQoZSA9PiB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGNvbnN0IGZvcm0gPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgbmFtZSA9IGZvcm0uZmluZChcIltuYW1lPSduYW1lJ11cIik7XHJcbiAgICAgICAgY29uc3QgcGhvbmUgPSBmb3JtLmZpbmQoXCJbbmFtZT0ncGhvbmUnXVwiKTtcclxuICAgICAgICBjb25zdCBjb21tZW50ID0gZm9ybS5maW5kKFwiW25hbWU9J2NvbW1lbnQnXVwiKTtcclxuICAgICAgICBjb25zdCB0byA9IGZvcm0uZmluZChcIltuYW1lPSd0byddXCIpO1xyXG5cclxuICAgICAgICBjb25zdCBtb2RhbCA9ICQoJyNtb2RhbCcpO1xyXG4gICAgICAgIGNvbnN0IGNvbnRlbnQgPSBtb2RhbC5maW5kKCcubW9kYWxfX21lc3NhZ2UnKVxyXG5cclxuICAgICAgICBjb25zdCBpc1ZhbGlkID0gdmFsaWRhdGVGaWVsZHMoZm9ybSwgW25hbWUsIHBob25lLCBjb21tZW50LCB0b10pO1xyXG5cclxuICAgICAgICBpZiAoaXNWYWxpZCkge1xyXG4gICAgICAgICAgICBjb25zdCByZXF1ZXN0ID0gJC5hamF4KHtcclxuICAgICAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vd2ViZGV2LWFwaS5sb2Z0c2Nob29sLmNvbS9zZW5kbWFpbCcsXHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6ICdwb3N0JyxcclxuICAgICAgICAgICAgICAgIGRhdGE6IHtcclxuICAgICAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIHBob25lOiBwaG9uZS52YWwoKSxcclxuICAgICAgICAgICAgICAgICAgICBjb21tZW50OiBjb21tZW50LnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgICAgIHRvOiB0by52YWwoKSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXF1ZXN0LmRvbmUoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50LnRleHQoZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIGNvbnRlbnQucmVtb3ZlQ2xhc3MoJ2Vycm9yLW1vZGFsJyk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXF1ZXN0LmZhaWwoZGF0YSA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhLnJlc3BvbnNlSlNPTi5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkYXRhLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgY29udGVudC50ZXh0KG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgY29udGVudC5hZGRDbGFzcygnZXJyb3ItbW9kYWwnKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHJlcXVlc3QuYWx3YXlzKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgICAgICAgICAgICAgc3JjOiBcIiNtb2RhbFwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IFwiaW5saW5lXCIsXHJcblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgJChcIi5hcHAtY2xvc2UtbW9kYWxcIikuY2xpY2soZSA9PiB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICQuZmFuY3lib3guY2xvc2UoKTtcclxuXHJcbiAgICB9KTtcclxufSkoKSIsIjtcclxuKGZ1bmN0aW9uKCkge1xyXG4gICAgY29uc3Qgc2VjdGlvbnMgPSAkKFwic2VjdGlvblwiKTtcclxuICAgIGNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xyXG4gICAgY29uc3QgZml4TWVudSA9ICQoXCIuZml4ZWQtbWVudVwiKTtcclxuICAgIGNvbnN0IG1lbnVJdGVtcyA9IGZpeE1lbnUuZmluZChcIi5maXhlZC1tZW51X19pdGVtXCIpO1xyXG4gICAgY29uc3QgbW9iaWxlRGV0ZWN0ID0gbmV3IE1vYmlsZURldGVjdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcbiAgICBjb25zdCBpc01vYmlsZSA9IG1vYmlsZURldGVjdC5tb2JpbGUoKTtcclxuICAgIGxldCBpblNjcm9sbCA9IGZhbHNlO1xyXG5cclxuICAgIHNlY3Rpb25zLmZpcnN0KCkuYWRkQ2xhc3MoXCJhY3RpdmUtc2VjdGlvblwiKTtcclxuICAgIGNvbnN0IGNvdW50U2VjdGlvblBvc2l0aW9uID0gc2VjdGlvbkVxID0+IHtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IHNlY3Rpb25FcSAqIC0xMDA7XHJcbiAgICAgICAgaWYgKGlzTmFOKHBvc2l0aW9uKSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwi0J/QtdGA0LXQtNCw0L3QviDQvdC1INCy0LXRgNC90L7QtSDQt9C90LDRh9C10L3QuNC1INCyIGNvdW50U2VjdGlvblBvc2l0aW9uXCIpO1xyXG4gICAgICAgICAgICByZXR1cm4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHBvc2l0aW9uO1xyXG5cclxuICAgIH07XHJcbiAgICBjb25zdCBjaGFuZ2VNZW51VGhlbWVGb3JTZWN0aW9uID0gc2VjdGlvbkVxID0+IHtcclxuICAgICAgICBjb25zdCBjdXJyZW50U2VjdGlvbiA9IHNlY3Rpb25zLmVxKHNlY3Rpb25FcSk7XHJcbiAgICAgICAgY29uc3QgbWVudVRoZW1lID0gY3VycmVudFNlY3Rpb24uYXR0cihcImRhdGEtZml4LW1lbnUtY29sb3JcIik7XHJcbiAgICAgICAgY29uc3QgYWN0aXZlQ2xhc3MgPSBcImZpeGVkLW1lbnUtLXdoaXRlXCI7XHJcblxyXG4gICAgICAgIGlmIChtZW51VGhlbWUgPT0gXCJsaWdodFwiKSB7XHJcbiAgICAgICAgICAgIGZpeE1lbnUuYWRkQ2xhc3MoYWN0aXZlQ2xhc3MpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGZpeE1lbnUucmVtb3ZlQ2xhc3MoYWN0aXZlQ2xhc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9O1xyXG4gICAgY29uc3QgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0gPSAoaXRlbXMsIGl0ZW1FcSwgYWN0aXZlQ2xhc3MpID0+IHtcclxuICAgICAgICBpdGVtcy5lcShpdGVtRXEpLmFkZENsYXNzKGFjdGl2ZUNsYXNzKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKGFjdGl2ZUNsYXNzKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwZXJmb3JtVHJhbnNpdG9uID0gKHNlY3Rpb25FcSkgPT4ge1xyXG4gICAgICAgIGlmIChpblNjcm9sbCkgcmV0dXJuO1xyXG4gICAgICAgIGNvbnN0IHRyYW5zaXRpb25PdmVyID0gMTAwMDtcclxuICAgICAgICBjb25zdCBtb3VzZUluZXJ0aWFPdmVyID0gMzAwO1xyXG4gICAgICAgIGluU2Nyb2xsID0gdHJ1ZTtcclxuICAgICAgICBjb25zdCBwb3NpdGlvbiA9IGNvdW50U2VjdGlvblBvc2l0aW9uKHNlY3Rpb25FcSk7XHJcbiAgICAgICAgY2hhbmdlTWVudVRoZW1lRm9yU2VjdGlvbihzZWN0aW9uRXEpO1xyXG5cclxuICAgICAgICBkaXNwbGF5LmNzcyh7XHJcbiAgICAgICAgICAgIHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHtwb3NpdGlvbn0lKWBcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbShzZWN0aW9ucywgc2VjdGlvbkVxLCBcImFjdGl2ZS1zZWN0aW9uXCIpO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgaW5TY3JvbGwgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0obWVudUl0ZW1zLCBzZWN0aW9uRXEsIFwiZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlXCIpO1xyXG5cclxuICAgICAgICB9LCB0cmFuc2l0aW9uT3ZlciArIG1vdXNlSW5lcnRpYU92ZXIpO1xyXG4gICAgfTtcclxuXHJcblxyXG5cclxuICAgIGNvbnN0IHZpZXBvcnRTY3JvbGxlciA9ICgpID0+IHtcclxuICAgICAgICBjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKFwiLmFjdGl2ZS1zZWN0aW9uXCIpO1xyXG4gICAgICAgIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XHJcbiAgICAgICAgY29uc3QgcHJldlNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLnByZXYoKTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgbmV4dCgpIHtcclxuICAgICAgICAgICAgICAgIGlmIChuZXh0U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBwZXJmb3JtVHJhbnNpdG9uKG5leHRTZWN0aW9uLmluZGV4KCkpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBwcmV2KCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHByZXZTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHBlcmZvcm1UcmFuc2l0b24ocHJldlNlY3Rpb24uaW5kZXgoKSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgJCh3aW5kb3cpLm9uKFwid2hlZWxcIiwgZSA9PiB7XHJcbiAgICAgICAgY29uc3QgZGVsdGFZID0gZS5vcmlnaW5hbEV2ZW50LmRlbHRhWTtcclxuICAgICAgICBjb25zdCBzY3JvbGxlciA9IHZpZXBvcnRTY3JvbGxlcigpO1xyXG4gICAgICAgIGlmIChkZWx0YVkgPiAwKSB7XHJcbiAgICAgICAgICAgIHNjcm9sbGVyLm5leHQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGRlbHRhWSA8IDApIHtcclxuICAgICAgICAgICAgc2Nyb2xsZXIucHJldigpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgJCh3aW5kb3cpLm9uKFwia2V5ZG93blwiLCBlID0+IHtcclxuICAgICAgICBjb25zdCB0YWdOYW1lID0gZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgICAgIGNvbnN0IHVzZXJUeXBpbmdJbklucHV0cyA9IHRhZ05hbWUgPT0gdGFnTmFtZSA9PSBcImlucHV0XCIgfHwgdGFnTmFtZSA9PSBcInRleHRhcmVhXCI7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWVwb3J0U2Nyb2xsZXIoKTtcclxuICAgICAgICBpZiAodXNlclR5cGluZ0luSW5wdXRzKSByZXR1cm47XHJcbiAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcclxuICAgICAgICAgICAgY2FzZSAzODpcclxuICAgICAgICAgICAgICAgIHNjcm9sbGVyLnByZXY7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSA0MDpcclxuICAgICAgICAgICAgICAgIHNjcm9sbGVyLm5leHQ7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgICQoXCJ3cmFwcGVyXCIpLm9uKFwidG91Y2htb3ZlXCIsIGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcclxuXHJcbiAgICAkKFwiW2RhdGEtc2Nyb2xsLXRvXVwiKS5jbGljayhlID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgY29uc3QgbmF2ID0gJChcIi5hY3RpdmVcIilcclxuICAgICAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1zY3JvbGwtdG9cIik7XHJcbiAgICAgICAgY29uc3QgcmVxU2VjdGlvbiA9ICQoYFtkYXRhLXNlY3Rpb24taWQ9JHt0YXJnZXR9XWApO1xyXG4gICAgICAgIG5hdi5jc3MoeyBkaXNwbGF5OiBcIm5vbmVcIiB9KTtcclxuICAgICAgICBwZXJmb3JtVHJhbnNpdG9uKHJlcVNlY3Rpb24uaW5kZXgoKSk7XHJcbiAgICB9KTtcclxuICAgIGlmIChpc01vYmlsZSkge1xyXG4gICAgICAgICQoXCJib2R5XCIpLnN3aXBlKHtcclxuXHJcbiAgICAgICAgICAgIHN3aXBlOiBmdW5jdGlvbihldmVudCwgZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zdCBzY3JvbGxlciA9IHZpZXBvcnRTY3JvbGxlcigpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHNjcm9sbERpcmVjdGlvbiA9IFwiXCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09IFwidXBcIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJuZXh0XCI7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGlyZWN0aW9uID09IFwiZG93blwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcInByZXZcIjtcclxuXHJcbiAgICAgICAgICAgICAgICBzY3JvbGxlcltzY3JvbGxEaXJlY3Rpb25dKCk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0pKCkiLCI7XHJcbihmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IHBsYXllciA9ICQoXCIucGxheWVyX19jb250ZW50XCIpO1xyXG4gICAgY29uc3QgZHVyYXRpb25Db250cm9sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXJfX3BsYXliYWNrLWR1cmF0aW9uXCIpO1xyXG4gICAgY29uc3QgY29udHJvbFByb2dyZXNzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXJfX3BsYXliYWNrLXByb2dyZXNzXCIpXHJcbiAgICBjb25zdCBzb3VuZFByb2dyZXNzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXJfX3NvdW5kLXByb2dyZXNzXCIpO1xyXG4gICAgY29uc3Qgc291bmRDb250cm9sID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXJfX3NvdW5kLXZvbHVtZS1sZXZlbFwiKTtcclxuICAgIGNvbnN0IE1BWF9TT1VORF9WQUxVRSA9IDEwO1xyXG4gICAgY29uc3QgdXBkYXRlUmFuZ2UgPSAxMDAwO1xyXG4gICAgY29uc3QgcGxheUJ1dHRvbk9uU2NyZWVuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXJfX29uLXNjcmVlbi1zdGFydFwiKTtcclxuICAgIGNvbnN0IHBsYXllckJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX19zdGFydFwiKTtcclxuICAgIGNvbnN0IHBsYXllckNvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX19jb250YWluZXJcIik7XHJcbiAgICBjb25zdCBwbGF5ZXJXcmFwcGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wbGF5ZXJfX3dyYXBwZXJcIik7XHJcbiAgICBjb25zdCBzb3VuZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGxheWVyX19zb3VuZC1pbWdcIik7XHJcbiAgICBsZXQgaW50ZXJ2YWxJZDtcclxuICAgIGxldCBzb3VuZExldmVsO1xyXG5cclxuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgIHBsYXllclswXS5hZGRFdmVudExpc3RlbmVyKFwiY2FucGxheXRocm91Z2hcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICBkdXJhdGlvbkNvbnRyb2wubWF4ID0gcGxheWVyWzBdLmR1cmF0aW9uO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGR1cmF0aW9uQ29udHJvbC5taW4gPSAwO1xyXG4gICAgICAgIGR1cmF0aW9uQ29udHJvbC52YWx1ZSA9IDA7XHJcbiAgICAgICAgZHVyYXRpb25Db250cm9sLm1heCA9IHBsYXllclswXS5kdXJhdGlvbjtcclxuICAgICAgICBzb3VuZENvbnRyb2wubWluID0gMDtcclxuICAgICAgICBzb3VuZENvbnRyb2wubWF4ID0gTUFYX1NPVU5EX1ZBTFVFO1xyXG4gICAgICAgIHZvbHVtZVByb2dyZXNzKCk7XHJcbiAgICAgICAgaW5pdFBsYXlCdXR0b24oKTtcclxuICAgICAgICBhZGRMaXN0ZW5lcigpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZnVuY3Rpb24gaW5pdFBsYXlCdXR0b24oKSB7XHJcbiAgICAgICAgY29uc3QgcGxheUJ1dHRvbnMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBsYXktYnV0dG9uXCIpO1xyXG4gICAgICAgIHBsYXlCdXR0b25zLmZvckVhY2goYnV0dG9uID0+IHtcclxuICAgICAgICAgICAgYnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwbGF5U3RvcClcclxuICAgICAgICAgICAgcHJvZ3Jlc3NQbGF5YmFjaygpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbiAgICBmdW5jdGlvbiBhZGRMaXN0ZW5lcigpIHtcclxuICAgICAgICBwbGF5ZXJXcmFwcGVyLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBwbGF5U3RvcCk7XHJcbiAgICAgICAgZHVyYXRpb25Db250cm9sLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBzZXRWaWRlb0R1cmF0aW9uKTtcclxuICAgICAgICBkdXJhdGlvbkNvbnRyb2wuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCBzdG9wSW50ZXJ2YWwpO1xyXG4gICAgICAgIHNvdW5kQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgY2hhbmdlU291bmRWb2x1bWUpO1xyXG5cclxuICAgICAgICBzb3VuZEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZSA9PiB7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgaWYgKHBsYXllclswXS52b2x1bWUgPT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcGxheWVyWzBdLnZvbHVtZSA9IHNvdW5kTGV2ZWw7XHJcbiAgICAgICAgICAgICAgICBzb3VuZENvbnRyb2wudmFsdWUgPSBzb3VuZExldmVsICogTUFYX1NPVU5EX1ZBTFVFO1xyXG4gICAgICAgICAgICAgICAgc291bmRCdXR0b24uY2xhc3NMaXN0LnJlbW92ZShcInBsYXllcl9fc291bmQtaW1nLS1tdXRlXCIpO1xyXG4gICAgICAgICAgICAgICAgdm9sdW1lUHJvZ3Jlc3MoKTtcclxuXHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBzb3VuZExldmVsID0gcGxheWVyWzBdLnZvbHVtZTtcclxuICAgICAgICAgICAgICAgIHBsYXllclswXS52b2x1bWUgPSAwO1xyXG4gICAgICAgICAgICAgICAgc291bmRDb250cm9sLnZhbHVlID0gMDtcclxuICAgICAgICAgICAgICAgIHNvdW5kQnV0dG9uLmNsYXNzTGlzdC5hZGQoXCJwbGF5ZXJfX3NvdW5kLWltZy0tbXV0ZVwiKTtcclxuICAgICAgICAgICAgICAgIHZvbHVtZVByb2dyZXNzKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBwbGF5U3RvcCgpIHtcclxuICAgICAgICBpZiAocGxheWVyWzBdLnBhdXNlZCkge1xyXG4gICAgICAgICAgICBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwodXBkYXRlRHVyYXRpb24sIHVwZGF0ZVJhbmdlKTtcclxuICAgICAgICAgICAgcGxheWVyWzBdLnBsYXkoKTtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbk9uU2NyZWVuLmNsYXNzTGlzdC5hZGQoXCJwbGF5ZXJfX29uLXNjcmVlbi1zdGFydC0taGlkZGVuXCIpO1xyXG4gICAgICAgICAgICBwbGF5ZXJDb250YWluZXIuY2xhc3NMaXN0LmFkZChcInBsYXllcl9fY29udGFpbmVyLS1wYXVzZWRcIik7XHJcblxyXG5cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzdG9wSW50ZXJ2YWwoKTtcclxuICAgICAgICAgICAgcGxheUJ1dHRvbk9uU2NyZWVuLmNsYXNzTGlzdC5yZW1vdmUoXCJwbGF5ZXJfX29uLXNjcmVlbi1zdGFydC0taGlkZGVuXCIpO1xyXG4gICAgICAgICAgICBwbGF5ZXJDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcInBsYXllcl9fY29udGFpbmVyLS1wYXVzZWRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZUR1cmF0aW9uKCkge1xyXG4gICAgICAgIGR1cmF0aW9uQ29udHJvbC52YWx1ZSA9IHBsYXllclswXS5jdXJyZW50VGltZTtcclxuICAgICAgICBwcm9ncmVzc1BsYXliYWNrKCk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gc2V0VmlkZW9EdXJhdGlvbigpIHtcclxuICAgICAgICBpbnRlcnZhbElkID0gc2V0SW50ZXJ2YWwodXBkYXRlRHVyYXRpb24sIHVwZGF0ZVJhbmdlKTtcclxuICAgICAgICBwbGF5ZXJbMF0uY3VycmVudFRpbWUgPSBkdXJhdGlvbkNvbnRyb2wudmFsdWU7XHJcbiAgICAgICAgcHJvZ3Jlc3NQbGF5YmFjaygpO1xyXG4gICAgICAgIGlmIChwbGF5ZXJbMF0ucGF1c2VkKSB7XHJcbiAgICAgICAgICAgIHBsYXllclswXS5wbGF5KCk7XHJcbiAgICAgICAgICAgIHBsYXlCdXR0b25PblNjcmVlbi5jbGFzc0xpc3QuYWRkKFwicGxheWVyX19vbi1zY3JlZW4tc3RhcnQtLWhpZGRlblwiKTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2cocGxheWVyWzBdLnZvbHVtZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBzdG9wSW50ZXJ2YWwoKSB7XHJcbiAgICAgICAgcGxheWVyWzBdLnBhdXNlKCk7XHJcbiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbElkKTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gY2hhbmdlU291bmRWb2x1bWUoKSB7XHJcbiAgICAgICAgcGxheWVyWzBdLnZvbHVtZSA9IHNvdW5kQ29udHJvbC52YWx1ZSAvIE1BWF9TT1VORF9WQUxVRTtcclxuICAgICAgICB2b2x1bWVQcm9ncmVzcygpO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHByb2dyZXNzUGxheWJhY2soKSB7XHJcbiAgICAgICAgY29uc3QgY29tcGxldGVQbGF5YmFja1BlcnNlbnQgPSAocGxheWVyWzBdLmN1cnJlbnRUaW1lIC8gcGxheWVyWzBdLmR1cmF0aW9uKSAqIDEwMDtcclxuICAgICAgICBjb250cm9sUHJvZ3Jlc3Muc3R5bGUud2lkdGggPSBjb21wbGV0ZVBsYXliYWNrUGVyc2VudCArIFwiJVwiO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHZvbHVtZVByb2dyZXNzKCkge1xyXG4gICAgICAgIGNvbXBsZXRlVm9sdW1lUGVyc2VudCA9IChwbGF5ZXJbMF0udm9sdW1lIC8gTUFYX1NPVU5EX1ZBTFVFKSAqIDEwMDA7XHJcbiAgICAgICAgc291bmRQcm9ncmVzcy5zdHlsZS53aWR0aCA9IGNvbXBsZXRlVm9sdW1lUGVyc2VudCArIFwiJVwiO1xyXG4gICAgfVxyXG59KSgpIiwiO1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICBjb25zdCBzbGlkZXIgPSAkKCcuc2xpZGVyX19saXN0JykuYnhTbGlkZXIoe1xyXG4gICAgICAgIHBhZ2VyOiBmYWxzZSxcclxuICAgICAgICBjb250cm9sczogZmFsc2UsXHJcbiAgICAgICAgLy90b3VjaEVuYWJsZWQ6IGZhbHNlXHJcbiAgICB9KTtcclxuXHJcbiAgICAkKCcuc2xpZGVyX19idXR0b24tLWxlZnQnKS5jbGljayhlID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgc2xpZGVyLmdvVG9QcmV2U2xpZGUoKTtcclxuICAgIH0pXHJcbiAgICAkKCcuc2xpZGVyX19idXR0b24tLXJpZ2h0JykuY2xpY2soZSA9PiB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIHNsaWRlci5nb1RvTmV4dFNsaWRlKCk7XHJcbiAgICB9KTtcclxuXHJcbn0pKCkiLCI7XHJcbihmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IGZpbmRCbG9jayA9IChhbGlhcykgPT4ge1xyXG4gICAgICAgIHJldHVybiAkKCcucmV2aWV3c19faXRlbScpLmZpbHRlcigobmR4LCBpdGVtKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiAkKGl0ZW0pLmF0dHIoJ2RhdGEtbGlua2VkLXdpdGgnKSA9PSBhbGlhcztcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICAkKCcuaW50ZXJhY3RpdmUtYXZhdGFyX19saW5rJykuY2xpY2soKGUpID0+IHtcclxuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgICAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cignZGF0YS1vcGVuJyk7XHJcbiAgICAgICAgY29uc3Qgc2hvd0l0ZW0gPSBmaW5kQmxvY2sodGFyZ2V0KTtcclxuICAgICAgICBjb25zdCBjdXJycmVudEl0ZW0gPSAkdGhpcy5jbG9zZXN0KCcucmV2aWV3c19fc2VsZWN0b3ItaXRlbScpXHJcbiAgICAgICAgc2hvd0l0ZW0uYWRkQ2xhc3MoJ3Jldmlld3NfX2l0ZW0tLWFjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ3Jldmlld3NfX2l0ZW0tLWFjdGl2ZScpXHJcbiAgICAgICAgY3VycnJlbnRJdGVtLmFkZENsYXNzKCdpbnRlcmFjdGl2ZS1hdmF0YXItLWFjdGl2ZScpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoJ2ludGVyYWN0aXZlLWF2YXRhci0tYWN0aXZlJyk7XHJcbiAgICB9KVxyXG59KSgpIiwiO1xyXG4oZnVuY3Rpb24oKSB7XHJcbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcclxuICAgICAgICBsZXQgbmFtZSA9ICQoJy5tZW1iZXJfX25hbWUnKTtcclxuICAgICAgICBuYW1lLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICBsZXQgZHJvcERvd24gPSAkKCcubWVtYmVyX19kcm9wZG93bicpO1xyXG4gICAgICAgICAgICBkcm9wRG93bi5zbGlkZVVwKDIwMCk7XHJcbiAgICAgICAgICAgIG5hbWUucmVtb3ZlQ2xhc3MoJ21lbWJlcl9fbmFtZS0tb3BlbicpO1xyXG4gICAgICAgICAgICBuYW1lLmFkZENsYXNzKCdtZW1iZXJfX25hbWUtLWNsb3NlZCcpO1xyXG4gICAgICAgICAgICBpZiAoISQodGhpcykubmV4dCgpLmlzKFwiOnZpc2libGVcIikpIHtcclxuICAgICAgICAgICAgICAgICQodGhpcykubmV4dCgpLnNsaWRlRG93bigyMDApO1xyXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnbWVtYmVyX19uYW1lLS1vcGVuJyk7XHJcbiAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdtZW1iZXJfX25hbWUtLWNsb3NlZCcpO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG59KSgpIl19
